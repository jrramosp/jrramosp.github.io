<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Comunicación entre máquinas</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="..\css\styles.css" type="text/css">
</head>
<body>
  <h2>Comunicación entre máquinas</h2>
  Que harás: En tus propias palabras, describe lo que sucede en cada paso de nuestro modelo de red cuando un nodo
  en una red establece una conexión TCP con un nodo en otra red. Puedes suponer que las dos redes están conectadas
  al mismo enrutador.<br>
  Tu presentación debe incluir una explicación detallada de lo siguiente:<br>
  ● Capa física x<br>
  ● Capa de enlace de datos x<br>
  ● Capa de red x<br>
  ● Capa de transporte x<br>
  ● Dirección MAC x<br>
  ● Dirección IP x<br>
  ● Puerto TCP x<br>
  ● Control de suma x<br>
  ● Tabla de ruteo x<br>
  ● TTL x<br>
  <img src="images/8-1.png" alt="images/8-1.png">
  El envío de datos de una máquina a otra comienza con la generación de datos por parte de los programas en la
  capa de aplicación, que pasan a la capa de transporte donde se encapsulan con una cabecera TCP y se envían a la
  capa de red. Allí esta capa a su vez encapsula los datos recibidos con una cabecera IP y los pasa a la capa de
  enlace de datos. En esta capa se encapsulan los datos con una cabecera Ethernet y de aquí se envían a la capa
  física.<br>
  La capa de aplicación es la que genera la primera trama de datos que pasarán a encapsularse en la capa de
  transporte. Estos datos utilizan una gran variedad de protocolo para intercambiar datos según la función que
  cumplan.<br>
  En la capa de transporte se reciben los datos que la capa de aplicación quiere enviar y se le añade una cabecera
  TCP o UDP. Un puerto es un número de 16 bits que sirve para entregar datos a un servicio específico de una
  aplicación concreta. Por ejemplo las páginas web de protocolo HTTP se entregan por el puerto 80. En el segmento
  TCP se encapsularan los puertos de aplicación de origen y destino, de los cuales este último pertenece a los que
  se conoce como puertos efímeros, que son un rango específico para los datos de salida que se asignan de forma
  aleatoria para el cliente por parte del servidor. Se realiza una comprobación de datos mediante suma de
  verificación y se añade un acuse de recibo para especificar que se espera la siguiente porción de datos, pues en
  la capa de transporte se dividen las tramas de datos mayores en trozos pequeños que luego se re-ordenaran en el
  destino con el número de secuencia, que también se añade a la trama.<br>
  En la capa de red se recibe el datagrama TCP de la capa de transporte y se le añade la cabecera IP, con las
  direcciones de destino y origen, se le añade el campo TTL o tiempo de vida con el número de saltos que puede dar
  el paquete antes de ser desechado, y se realiza una suma de comprobación de datos.<br>
  En la capa de enlace de datos mediante el protocolo Ethernet se encapsularan el datagrama IP (carga útil) que
  viene de la capa de red, con las direcciones MAC de nodo de origen y nodo de destino. En la trama Ethernet se
  realiza el CRC o control de suma de verificación de datos para comprobar la integridad de datos. Esta trama de
  datos pasan a la capa física.<br>
  Con los datos de dirección IP de destino y la tabla de ruteo, que se encuentra en los dispositivos conectados a
  la red, routers, se puede determinar en que lugar de la red se encuentra la maquina de destino, o si no se
  conoce enviar una trama ARP de consulta con la que la máquina destino responderá cual es su dirección MAC, y así
  obtener el camino que ha de tomarse.<br>
  Cuando un nodo establece conexión TCP con otro nodo en otra red utiliza la capa física para enviar la señal de
  datos a través de los cables que conectan ambos nodos. Probablemente la comunicación transcurre por un par
  trenzado y conectores tipo RJ45. Mediante la modulación se enviaran la trama de datos por los cables que son de
  tipo cobre o de fibra.<br>
  Todo este proceso se realiza para comunicar de una máquina a otra una sola vez. Pero este proceso se repite en
  cada intercomunicación.<br>
  ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~<br>
  Imagina tres redes. La red A va a contener el espacio de direcciones 10.1.1.0/24. La red B va a contener el
  espacio de direcciones 192.168.1.0/24, y la red C será 172.16.1.0/24. El router A se encuentra entre la red A y
  la red B con una interfaz cuya IP está configurada como 10.1.1.1 en la red A, y una interfaz en 192.168.1.254 en
  la red B. Hay un segundo router, el router B, que conecta las redes B y C. Tiene una interfaz en la red B, cuya
  dirección IP es 192.168.1.1, y una interfaz en la red C, cuya dirección IP es 172.16.1.1. Ahora vamos a poner
  una computadora en una de las redes. Imagina que es un equipo de escritorio, ubicado en el escritorio de alguien
  en el lugar de trabajo. Será nuestro cliente en esta situación y la llamaremos computadora 1. Es parte de la red
  A y se le asignó la dirección IP 10.1.1.100. Ahora, pongamos otra computadora en una de las otras redes.<br>
  Este es un servidor en un centro de datos, actuará como nuestro servidor en esta situación, y la llamaremos
  computadora 2. Es parte de la red C, se le asignó la dirección IP 172.16.1.100 y tiene un servidor web que
  escucha en el puerto 80. Un usuario final en la computadora 1 abre un navegador web y escribe 172.16.1.100 en la
  barra de direcciones. Veamos qué ocurre. El navegador web que se ejecuta en la computadora 1 sabe que se le
  ordenó recuperar una página web de 172.16.1.100. El navegador web se comunica con la pila de redes local, que es
  la parte del sistema operativo responsable de manejar las funciones de red. El navegador web explica va a querer
  establecer una conexión TCP a 172.16.1.100, puerto 80. Ahora, la pila de redes va a examinar su propia subred.
  Ve que está ubicada en la red 10.1.1.0/24, lo que significa que el destino 172.16.1.100 está en otra red. En
  este punto, la computadora 1 sabe que tiene que enviar cualquier dato a su puerta de enlace para que lo encamine
  a una red remota. Y está configurada con una puerta de enlace en 10.1.1.1. A continuación, la computadora 1 mira
  su tabla ARP para determinar qué dirección MAC de 10.1.1.1 es, pero no encuentra ninguna entrada
  correspondiente. Ay, está bien, la computadora A hace una solicitud ARP para una dirección IP de 10.1.1.1, que
  envía a la dirección de difusión del hardware, que son todas F. Esta solicitud de detección ARP se envía a cada
  nodo en la red local.<br>
  Cuando el router A recibe este mensaje ARP, ve que es la computadora que actualmente tiene asignada la dirección
  IP 10.1.1.1. Entonces, le responde a la computadora 1 para hacerle saber su propia dirección MAC:
  00:11:22:33:44:55. La computadora 1 recibe esta respuesta y ahora conoce la dirección de hardware de su puerta
  de enlace. Esto significa que está lista para comenzar a construir el paquete saliente.<br>
  La computadora 1 sabe que el navegador web le está pidiendo que forme una conexión TCP saliente, lo que
  significa que necesitará un puerto TCP de salida. El sistema operativo identifica el puerto efímero 50000 como
  disponible y abre un socket que conecta el navegador web a este puerto.<br>
  Como esta es una conexión TCP, la pila de redes sabe que antes de poder transmitir cualquier dato que el
  navegador web quiera, tendrá que establecer una conexión. La pila de redes comienza a construir un segmento TCP.
  Completa todos los campos que corresponden en el encabezado, incluyendo un puerto de origen de 50000 y un puerto
  de destino 80. Se elige un número de secuencia y se lo usa para completar el campo del número de secuencia. Por
  último, se establece el indicador SYN, se calcula la suma de verificación para el segmento y se la escribe en el
  campo de suma de verificación.<br>
  Nuestro segmento TCP recién construido ahora se transfiere a la capa IP de la pila de redes. Esta capa construye
  un encabezado IP. Este encabezado se completa con la IP de origen, la IP de destino y un TTL igual a 64, que es
  un bonito valor estándar para este campo.<br>
  A continuación, el segmento TCP se inserta como la carga útil de datos para el datagrama IP. Y se calcula una
  suma de verificación para todo esto. Ahora que se construyó el datagrama IP, la computadora 1 necesita enviar
  esto a su puerta de enlace, que ahora sabe que su dirección MAC es 00:11:22:33:44:55. Por lo tanto, se arma una
  trama de Ethernet. Todos los campos relevantes se completaron con los datos adecuados, sobre todo, las
  direcciones MAC de origen y destino.<br>
  Por último, el datagrama IP se inserta como la carga útil de datos de la trama de Ethernet y se calcula otra
  suma de verificación. Ahora tenemos toda una trama de Ethernet lista para enviar a través de la capa física. La
  interfaz de red conectada a la computadora 1 envía estos datos binarios como modulaciones del voltaje de una
  corriente eléctrica que atraviesa un cable Cat6 conectado entre la computadora 1 y un conmutador de red.<br>
  Este conmutador recibe la trama y luego inspecciona la dirección MAC de destino. El conmutador sabe a cuál de
  sus interfaces se conecta esta dirección MAC y reenvía la trama sólo a través del cable conectado a esta
  interfaz.<br>
  En el otro extremo de este enlace está el router A, que recibe la trama y reconoce su propia dirección de
  hardware como destino.<br>
  El router A sabe que esta trama está destinada a él. Ahora, toma la totalidad de la trama y le calcula una suma
  de verificación. El router A compara esta suma de verificación con la que está en el encabezado de la trama de
  Ethernet y ve que coinciden. Esto significa que todos los datos llegaron sanos y salvos. A continuación, el
  router A desarma la trama de Ethernet y se queda con el datagrama IP. De nuevo, realiza una suma de verificación
  para todo el datagrama. Y una vez más, encuentra que coincide. Es decir, todos los datos son correctos.
  Inspecciona la dirección IP de destino y realiza una búsqueda de este destino en su tabla de enrutamiento. El
  router A ve que para enviar datos a la red 172.16.1.0/24, el camino más rápido está a un salto a través del
  router B, cuya IP es 192.168.1.1. El router A mira todos los datos en el datagrama IP, disminuye el TTL en 1,
  calcula una nueva suma de verificación que refleje ese nuevo valor TTL y hace un nuevo datagrama IP con estos
  datos.<br>
  El router A sabe que necesita enviar este datagrama al router B, cuya dirección IP es 192.168.1.1. Mira su tabla
  ARP y ve que tiene una entrada para 192.168.1.1. Ahora, el router A puede comenzar a construir una trama
  Ethernet con la dirección MAC de su interfaz en la red B como origen, y la dirección MAC en la interfaz del
  router B en la red B como destino. Una vez que se completaron los valores para todos los campos de esta trama,
  el router A coloca el datagrama IP recién construido en el campo de carga útil de datos. Calcula una suma de
  verificación, la coloca en su lugar y envía la trama a la red B.<br>
  Al igual que antes, esta trama atraviesa la red B y es recibida por el router B. El router B realiza todas las
  mismas verificaciones, elimina la encapsulación de la trama Ethernet y realiza una suma de verificación contra
  el datagrama IP.<br>
  Luego examina la dirección IP de destino. Al mirar su tabla de enrutamiento, el router B ve que la dirección de
  destino de la computadora 2, o 172.16.1.100, está en una red conectada localmente. Así, disminuye nuevamente en
  1 el valor del TTL, calcula una nueva suma de verificación y crea un nuevo datagrama IP. Una nueva trama
  Ethernet vuelve a encapsular a este nuevo datagrama IP, en este caso, con las direcciones MAC de origen y
  destino del router B y la computadora 2. Y todo el proceso se repite por última vez. La trama se envía a la red
  C, un conmutador asegura que se envíe a la interfaz a la que está conectada la computadora 2. La computadora 2
  recibe la trama, identifica su propia dirección MAC como destino, y sabe que la trama es para ella. La
  computadora 2 luego quita la trama Ethernet y se queda con el datagrama IP. Realiza un CRC y reconoce que los
  datos se entregaron intactos. Luego examina la dirección IP de destino y la reconoce como propia.<br>
  A continuación, la computadora 2 desarma el datagrama IP, quedándose solo con el segmento TCP. Una vez más, se
  examina la suma de verificación para esta capa, y todo concuerda. Luego, la computadora 2 examina el puerto de
  destino, que es 80. La pila de redes en la computadora 2 se asegura de que haya un socket abierto en el puerto
  80. Ahí está. Está en estado LISTEN y un servidor web Apache en ejecución lo mantiene abierto. La computadora 2
  entonces ve que este paquete tiene el conjunto de indicadores SYN. Entonces examina el número de secuencia y lo
  guarda, ya que deberá colocar ese número de secuencia en el campo de acuse de recibo una vez que genere la
  respuesta.<br>
  Después de todo eso, todo lo que hemos hecho es enviar un solo segmento TCP que contiene un indicador SYN de una
  computadora a otra. Todo debería ocurrir una vez más para que la computadora 2 envíe una respuesta SYN-ACK a la
  computadora 1. Entonces, todo tendría que repetirse una vez más para que la computadora 1 envíe un ACK de nuevo
  a la computadora 2, y así sucesivamente.
  <p align="center"><img src="images/home.png" height="22" width="22"> <a href="index.html">Índice</a></p>
</body>
</html>
