<!DOCTYPE html>
<html>
<head>
    <meta name="generator" content="HTML Tidy for HTML5 for Linux version 5.2.0">
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
    <title>Monitoreo de Red</title>
    <meta name="generator" content="CherryTree">
    <link rel="stylesheet" href="..\css\styles.css" type="text/css">
</head>
<body>
    <h2>Monitoreo de Red</h2><a name="h3-1" id="h3-1"></a>
    <h3>Olfateando la red</h3>Para supervisar qué tipo de tráfico hay en tu red, necesitas un mecanismo para capturar
    paquetes del tráfico de red para análisis y registro potencial. La <strong>detección (sniffing) o captura de
    paquetes</strong> es un proceso de intercepción de paquetes de red en su totalidad para su análisis.<br>
    De manera predeterminada, las interfaces de red y la pila de software de red en un SO se van a comportar como una
    interfaz bien educada. Solo aceptarán y procesarán paquetes enviados con una dirección de interfaz específica,
    usualmente identificada por una dirección MAC. Si se encuentra un paquete con una dirección de destino diferente,
    la interfaz la descartará. Pero, si quisiéramos capturar todos los paquetes que una interfaz puede ver, como cuando
    estamos supervisando todo el tráfico de red en un segmento de red, este comportamiento sería una molestia para
    nosotros.<br>
    Para hacer caso omiso de esto, podemos colocar la interfaz en lo que se llama <strong>modo promiscuo</strong>. Este
    es un modo especial para interfaces de red Ethernet que básicamente dice: "Dame todos los paquetes". En lugar de
    aceptar y manejar solo aquellos paquetes destinados a su dirección, ahora aceptará y procesará cualquier paquete
    que vea. Esto es mucho más útil para fines de análisis o supervisión de redes. También debo señalar que se
    necesitan privilegios de administrador o grupo para colocar una interfaz en modo promiscuo y comenzar a capturar
    paquetes. Muchas herramientas de captura de paquetes manejarán esto por ti también.<br>
    Otra cosa muy importante a tener en cuenta al realizar captura de paquetes es si tienes acceso al tráfico que
    deseas capturar y supervisar. Supongamos que quisieras analizar todo el tráfico entre hosts conectados a un
    conmutador y tu máquina también está conectada a un puerto en el conmutador. ¿Qué tráfico podrías ver en este caso?
    Dado que esto es un conmutador, el único tráfico que podrías capturar sería el tráfico desde o hacia tu host. Eso
    no es muy útil para que puedas analizar el tráfico de otros hosts. Si, en primer lugar, los paquetes no se envían a
    tu interfaz, el modo promiscuo no te ayudará a verlos. Pero si tu máquina está insertada entre el puerto de enlace
    ascendente del conmutador y el dispositivo de enlace ascendente anterior, ahora tendrías acceso a todos los
    paquetes que entran y salen de ese segmento de red local.<br>
    Los conmutadores de administración empresarial suelen tener una función llamada <strong>duplicación de
    puertos</strong> que ayuda en este tipo de situación. La duplicación de puertos permite que el conmutador tome
    todos los paquetes de un puerto específico, un rango de puertos o toda la VLAN, y los duplique en un puerto de
    conmutador específico. Esto te permite acceder a todos los paquetes que pasan por un conmutador de una manera más
    cómoda y segura.<br>
    Hay otra forma práctica, aunque menos avanzada, de obtener acceso a paquetes en un entorno de red con conmutadores.
    Puedes insertar un concentrador en la topología, con los dispositivos en los que te gustaría supervisar el tráfico
    conectados al concentrador y a nuestra máquina de supervisión. Los concentradores son una forma provisional de
    duplicar paquetes en tu interfaz de captura. Aunque obviamente tienen inconvenientes, como un rendimiento reducido
    y el potencial para la introducción de colisiones.<br>
    Si capturas paquetes desde una red inalámbrica, el proceso es ligeramente diferente. El modo promiscuo aplicado a
    un dispositivo inalámbrico permitiría al cliente inalámbrico procesar y recibir paquetes de la red a la que está
    asociada, destinados para otros clientes. Pero si quisiéramos capturar y analizar todo el tráfico inalámbrico que
    podemos recibir en el área inmediata, podemos colocar nuestra interfaz inalámbrica en un modo llamado "<strong>modo
    monitor</strong>". El modo monitor nos permite escanear los canales para ver todo el tráfico inalámbrico que envían
    los AP y los clientes. No importa a qué redes está destinado ni tampoco haría falta que el dispositivo cliente esté
    asociado o conectado a alguna red inalámbrica. Para capturar el tráfico inalámbrico, todo lo que necesitas es una
    interfaz colocada en modo monitor. Al igual que cuando habilitamos el modo promiscuo, esto se puede hacer con un
    comando simple, pero por lo general, las herramientas utilizadas para la captura inalámbrica de paquetes pueden
    manejar la habilitación y deshabilitación del modo por ti. Necesitas estar lo suficientemente cerca del AP y del
    cliente para recibir una señal, y luego puedes comenzar a capturar el tráfico desde el aire. Hay una serie de
    utilidades inalámbricas de captura y supervisión de código abierto, como Aircrack-ng y Kismet. Es importante
    señalar que si una red inalámbrica está encriptada, aun así puedes capturar paquetes, pero no podrás decodificar
    las cargas útiles de tráfico sin conocer la contraseña de la red inalámbrica.<br>
    <a name="h3-2" id="h3-2"></a>
    <h3>Wireshark y tcpdump</h3><strong>Tcpdump</strong> es una utilidad ligera y súper popular, basada en línea de
    comandos, que puedes usar para capturar y analizar paquetes. Tcpdump usa la biblioteca de código abierto libpcap.
    Es una biblioteca de captura de paquetes muy popular que se usa en muchas herramientas de captura y análisis de
    paquetes. Tcpdump también admite escribir las capturas de paquetes en un archivo para su análisis posterior, para
    compartirlas o para recrear el tráfico. También admite la lectura de las capturas de paquetes desde de un
    archivo.<br>
    El modo de funcionamiento predeterminado de tcpdump es proporcionar un breve análisis de paquetes. Convierte
    información clave a partir de la capa 3 en formatos legibles por humanos. Luego, imprime la información sobre cada
    paquete a la salida estándar, o directamente en tu terminal. Hace cosas como convertir las direcciones IP de origen
    y destino en el formato con cuatro puntos al que estamos más acostumbrados. Y muestra los números de puerto en uso
    por las comunicaciones.<br>
    Veamos rápidamente la salida de una muestra de tcpdump. El primer bit de información es bastante sencillo. Es una
    marca de tiempo que representa el momento en que el paquete en esta línea fue procesado por el kernel, en hora
    local. A continuación, se identifica el protocolo de capa 3; en este caso, IPv4. Luego, se muestran las cuatros
    direcciones que intervienen en la conexión: Dirección de origen, puerto de origen, dirección de destino y puerto de
    destino. A continuación, se establecen los indicadores TCP y el número de secuencia TCP en el paquete, si hay
    alguno. A esto le sigue el número de acuse de recibo, el tamaño de ventana TCP, luego las opciones de TCP si es que
    están establecidas. Por último, tenemos el tamaño de la carga útil en bytes.<br>
    Tcpdump nos permite inspeccionar de verdad estos valores directamente desde los paquetes. Quiero señalar que
    tcpdump, de manera predeterminada, intentará resolver las direcciones de host en nombres de host. También
    reemplazará los números de puerto con los servicios comúnmente asociados que usan estos puertos. Podrías anular
    este comportamiento con un indicador -n. También es posible ver los datos sin procesar reales que componen el
    paquete. Esto se representa como dígitos hexadecimales por medio del indicador -x, o -X mayúscula si quieres que
    los datos en hexadecimal se interpreten como ASCII.<br>
    Recuerda que los paquetes son solo colecciones de datos, o grupos de unos y ceros. Representan información de
    acuerdo con los valores de estos datos y con su ubicación en el flujo de datos. Piense en los encabezados de
    paquetes y en cómo se estructuran y formatean. La representación de tcpdump nos permite ver los datos que encajan
    en los diversos campos que conforman los encabezados de las capas en un paquete.<br>
    <strong>Wireshark</strong> es otra herramienta de captura y análisis de datos que puedes usar, pero es mucho más
    poderosa en lo que respecta a análisis de aplicaciones y paquetes, en comparación con tcpdump. Es una utilidad
    gráfica que también usa la biblioteca libpcap para la captura y la interpretación de paquetes. Pero es mucho más
    extensible en lo que respecta al análisis de protocolos y aplicaciones.<br>
    Mientras que tcpdump puede hacer análisis básico de algunos tipos de tráfico, como consultas y respuestas de DNS,
    Wireshark puede hacer mucho más. Wireshark puede decodificar cargas útiles encriptadas si se conoce la clave de
    encriptación. Puede identificar y extraer datos de carga útil de las transferencias de archivos a través de
    protocolos como SMB o HTTP. La comprensión de Wireshark de los protocolos de nivel de aplicación incluso se
    extienden a sus strings de filtrado. Esto permite reglas de filtrado, como encontrar solicitudes HTTP con strings
    específicas en la URL, lo que se vería como: http.request.uri matches "q = wireshark". Esa string de filtrado
    localizaría paquetes en nuestra captura que contienen una solicitud de URL que tengan la string especificada en
    ellos. En este caso, coincidiría con un parámetro de consulta de una URL en busca de Wireshark. Si bien esto podría
    hacerse con tcpdump, es mucho más fácil usar Wireshark.<br>
    Veamos rápidamente la interfaz de Wireshark, que se divide en tercios. La lista de paquetes está arriba, seguida de
    la representación en capas de un paquete seleccionado de la lista. Por último, la representación hexadecimal y
    ASCII del paquete seleccionado, en la parte inferior. La vista de lista de paquetes está codificada por colores
    para distinguir los diferentes tipos de tráfico en la captura. El usuario puede configurar el código de colores,
    los valores predeterminados son: verde para paquetes TCP, azul claro para el tráfico UDP, y azul oscuro para el
    tráfico DNS. El negro también destaca paquetes TCP problemáticos, como paquetes defectuosos o repetidos. Por encima
    del panel de la lista de paquetes, hay un cuadro de filtro de pantalla, que permite mostrar el filtrado complejo de
    paquetes. Esto es diferente de los filtros de captura, que siguen el estándar libpcap, junto con tcpdump. La
    comprensión profunda de Wireshark sobre protocolos permite el filtrado por protocolos junto con sus campos
    específicos. Como Wireshark admite más de 2,000 protocolos, no los veremos en detalle.<br>
    Wireshark no solo tiene un modo muy práctico de infiltrarse en el manejo de protocolos, también entiende y puede
    seguir sesiones o transmisiones de TCP. Esto te permite reensamblar y ver rápidamente ambos lados de una sesión de
    TCP, por lo que puedes ver fácilmente el intercambio bidireccional completo de información entre las partes. Otra
    característica de Wireshark es su capacidad para descifrar paquetes inalámbricos con encriptación WPA y WEP si se
    conoce la frase de contraseña. También es capaz de ver tráfico Bluetooth con el hardware correcto, junto con el
    tráfico USB y otros protocolos como Zigbee. También admite file carving, o la extracción de datos de las cargas
    útiles de los archivos transferidos sobre protocolos no cifrados, como las transferencias de archivos HTTP o FTP. Y
    es capaz de extraer secuencias de audio del tráfico VoIP sin cifrar, por lo que, básicamente, Wireshark es
    increíble.<br>
    Te preguntarás cómo el análisis de captura de paquetes encaja en la seguridad en este punto. Al igual que el
    análisis de registros, el análisis del tráfico es también una parte importante de la seguridad de la red. El
    análisis del tráfico se realiza mediante capturas y análisis de paquetes. El tráfico en una red es, básicamente, un
    flujo de paquetes. Poder capturar esos paquetes y lograr inspeccionarlos es importante para entender qué tipo de
    tráfico, del que fluye por nuestras redes, nos gustaría proteger.<br>
    <a name="h3-3" id="h3-3"></a>
    <h3>Sistemas de prevención / detección de intrusos</h3>Los <em>sistemas de prevención y detección de
    intrusiones</em> <strong>IDS o IPS</strong> supervisan y analizan el tráfico de red. ¿Qué es exactamente lo que
    hacen los sistemas IDS e IPS? Buscan comportamientos o características que indiquen tráfico malicioso.<br>
    La diferencia entre un sistema IDS y un IPS es que IDS es solo un sistema de detección. No tomará medidas para
    bloquear o impedir un ataque cuando se lo detecte, solo registrará una alerta. Pero un sistema IPS puede ajustar
    las reglas del firewall sobre la marcha para bloquear o descartar el tráfico malicioso cuando lo detecte.<br>
    Los sistemas IDS/IPS pueden ser basados en host o en la red. En el caso de un <em>sistema de detección de
    intrusiones de red</em>, o <strong>NIDS</strong>, el sistema de detección se implementaría en algún lugar de una
    red donde pueda monitorear el tráfico para un segmento de red o subred.<br>
    Un <strong>sistema de detección de intrusiones basado en host</strong> sería un software implementado en el host
    que supervisa el tráfico solo hacia y desde ese host. También puede supervisar los archivos del sistema para
    detectar cambios no autorizados.<br>
    Los sistemas NIDS se parecen a los firewalls de muchas maneras. Pero un firewall está diseñado para impedir
    intrusiones bloqueando el tráfico potencialmente malicioso procedente del exterior, y para hacer cumplir las ACL
    entre redes. Los sistemas NIDS están destinados a detectar y alertar sobre una posible actividad maliciosa
    proveniente de la red. Además, los firewalls solo tienen visibilidad del tráfico que fluye entre las redes en las
    que se los configuró para que las protejan. En general, no tendrán visibilidad del tráfico entre hosts dentro de la
    red. Por lo tanto, la ubicación del NIDS debe considerarse cuidadosamente al implementar un sistema. Debe estar
    ubicado en la topología de la red de manera que tenga acceso al tráfico que nos gustaría supervisar.<br>
    Una buena manera de obtener acceso al tráfico de la red es mediante la funcionalidad de duplicación de puertos
    hallada en muchos conmutadores de calidad empresarial. Esto permite que todos los paquetes en un puerto, rango de
    puerto o VLAN completa se dupliquen en otro puerto, en el que se conectaría el host NIDS. Con esta configuración,
    nuestra máquina NIDS podría ver todos los paquetes que entran y salen de los hosts en el segmento del conmutador.
    Esto nos permite supervisar las comunicaciones de host a host y el tráfico de hosts a redes externas, como
    Internet. Los hosts de NIDS analizarían este tráfico mediante la habilitación del modo promiscuo en el puerto de
    análisis. Este es la interfaz de red conectada al puerto de duplicación en nuestro conmutador para que pueda ver
    todos los paquetes que están pasando y realizar un análisis sobre el tráfico. Dado que esta interfaz se usa para
    recibir paquetes duplicados de la red que nos gustaría supervisar, un host NIDS debe tener al menos dos interfaces
    de red. Una es para supervisión y análisis, y la otra, separada, es para conexión con nuestra red a fines de
    gestión y administración. Algunos sistemas NID o NIP populares son Snort, Suricata, y Zeek NIDS.<br>
    <a href="https://www.snort.org/">https://www.snort.org/</a><br>
    <a href="https://suricata-ids.org/">https://suricata-ids.org/</a><br>
    <a href="https://www.zeek.org/">https://www.zeek.org/</a><br>
    La instalación de un sistema <strong>NIP</strong>, o de <em>prevención de intrusiones de red</em>, será diferente
    de la de un sistema NIDS. Esto se debe a que un sistema de prevención debe poder tomar medidas contra un tráfico
    malicioso sospechoso. Para que un dispositivo NIPS bloquee o descarte el tráfico de una amenaza detectada, debe
    estar colocado en línea con el tráfico que se supervisa. Esto significa que el tráfico bajo supervisión debe pasar
    a través del dispositivo NIPS. Si ese no fuera el caso, el host NIPS no podría tomar medidas en caso de tráfico
    sospechoso. Piénsalo de esta manera: un dispositivo NIDS es un observador pasivo que solo vigila el tráfico y envía
    una alerta si ve algo. Esto es diferente de un dispositivo NIPS, que no solo supervisa el tráfico, sino que puede
    tomar medidas sobre el tráfico bajo su supervisión, por lo general, bloqueando o descartando ese tráfico.<br>
    La detección de amenazas o de tráfico malicioso se maneja, en general, a través de la detección basada en firmas,
    algo similar a cómo el software antivirus detecta malware. Las firmas son características únicas del tráfico
    malicioso conocido. Podrían ser secuencias específicas de paquetes o paquetes con ciertos valores codificados en el
    campo de encabezado específico. Esto permite que los sistemas de prevención y detección de intrusiones reconozca
    fácil y rápidamente el tráfico malo conocido de fuentes como botnets, gusanos y otros vectores de ataque comunes en
    Internet. Pero de manera similar a un antivirus, los ataques menos comunes y dirigidos podrían no ser detectados
    por un sistema basado en firmas, ya que podrían no ser firmas desarrolladas para estos casos. Por lo tanto, también
    es posible crear reglas personalizadas que coincidan con el tráfico que podría considerarse sospechoso, pero no
    necesariamente malicioso. Esto permitiría a los investigadores estudiar el tráfico en más detalle para determinar
    el nivel de maldad. Si se determina que el tráfico es malicioso, se puede desarrollar una firma a partir del
    tráfico y luego incorporarla al sistema.<br>
    ¿Qué sucede realmente cuando un sistema NIDS detecta algo malicioso? Esto puede configurarse, pero en general el
    sistema NIDS registrará el evento de detección junto con una captura completa de paquetes del tráfico malicioso.
    También suele activarse una alerta para notificar al equipo investigador que estudiará ese tráfico detectado.
    Dependiendo de la gravedad del evento, la alerta puede simplemente enviar un correo electrónico a un grupo, crear
    un ticket para seguimiento o podría llamar a alguien en medio de la noche si se determina que su gravedad es muy
    alta y urgente. Usualmente, estas alertas también incluyen información de referencia vinculada a una vulnerabilidad
    conocida o más información sobre la naturaleza de la alerta para ayudar al investigador a estudiar el evento.
    <p align="center"><img src="images/home.png" height="22" width="22"> <a href="index.html">Índice</a></p>
</body>
</html>
